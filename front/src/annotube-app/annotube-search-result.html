<!--
Search result page

By: Tom
-->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../components/search-result-item.html">
<link rel="import" href="../components/search-bar.html">
<link rel="import" href="./shared-styles.html">

<dom-module id="annotube-search-result">
  <template>
    <style include="shared-styles">
      .form-wrapper {
          width: 40%;
          height: 40px;
          min-width: 300px;
          margin: 1% auto;
          box-shadow: 2px 2px 5px lightgray ; 
      }

      .prevNext{
        display: flex;
      }
      .divPrev{
       margin-right: auto;
       padding: 10px;
     }
     .divNext{
       margin-left: auto;
       padding: 10px;
     }
    </style>
<iron-ajax id="ajax" url="https://www.googleapis.com/youtube/v3/search" params='{"part":"snippet", "key": "AIzaSyC9geJJJDJxUnFc6890jzFq9yBJsBEzJuU", "type": "video","relevanceLanguage":"fr-fr", "maxResults":"10"}'
  handle-as="json" last-response="{{response}}" debounce-duration="300" on-response="youtubeResponse"></iron-ajax>
  
<div class="card" style="padding-top: 1px;">
  <form class="form-wrapper" method="get" target="_self">
    <search-bar></search-bar>
  </form>
  <template is="dom-repeat" items="[[response.items]]">
    <search-result-item youtube-item="{{item}}"></search-result-item>
  </template>
  <div class="prevNext">
    <div class="divPrev" align="left">
      <template is="dom-if" if="[[prevPageTk]]">
        <paper-button raised id="prevPageBt" on-tap="reload">&larr; Précédente</paper-button>
      </template>
    </div>
    <div class="divNext" align="right">
      <template is="dom-if" if="[[nextPageTk]]">
        <paper-button raised id="nextPageBt" on-tap="reload">Suivante &rarr;</paper-button>
      </template>
    </div>
  </div>
</div>

</template>

<script>
  Polymer({
    is: 'annotube-search-result',

    properties: {
      nextPageTk: {
        type: String,
        notify: true
      },
      prevPageTk: {
        type: String,
        notify: true
      }
    },
    ready: function(){
      this.$.ajax.params.q = window.location.search.substr(1).split("=")[1];
      this.$.ajax.generateRequest();
    },
    reload: function (e) {
      if (e.target.id == "nextPageBt") {
        this.$.ajax.params.pageToken = this.nextPageTk;
      } else {
        this.$.ajax.params.pageToken = this.prevPageTk;
      }
      this.$.ajax.generateRequest();
    },
    youtubeResponse: function (result) {
      this.nextPageTk = result.detail.response.nextPageToken;
      this.prevPageTk = result.detail.response.prevPageToken;
    }
  });

</script>
</dom-module>