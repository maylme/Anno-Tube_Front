<!--
    Page of the editing tool 
    By: Mayl & Edouard
-->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/google-youtube/google-youtube.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../components/video-display.html">
<link rel="import" href="../components/editing-time-bar.html">
<link rel="import" href="./shared-styles.html">


<dom-module id="annotube-edit">
    <template>
        <style include="shared-styles">
            :host {
                display: block;
            }
            video-display {
                position: relative;
                width: 100%;
            }
            .playing_aera {
                width: 100%;
                display: inline-flex;
                padding-bottom: 10px;
                border-bottom: dashed 1px lightgrey;
                position: relative;
            }
            .video_part {
                width: 60%;
                display: inline-block;
                margin: 0;
                padding: 0;
            }
            .link_part {
                width: 40%;
                margin: 0;
                padding: 15px;
            }
            .link_part div {
                border: solid grey 1px;
            }
            .editing_part{
              margin-top: 20px 
            }
        </style>

        <div class="card pd16">
            <h1>[[videoName]]</h1>
            <div class="playing_aera">
                <div class="video_part">
                  <video-display class="video" 
                    video-id="{{youtubeId}}" 
                    annotations="{{annotations}}"
                    play="{{play}}" 
                    duration= "{{duration}}" 
                    currenttime="{{currenttime}}"
                    foreigntime="{{foreigntime}}"
                    ></video-display>
                </div>
                <div class="link_part ">
                    <div class="pd16 ">partie des liens wikipedia
                    </div>
                </div>
            </div>
            <div class="editing_part">
              <editing-time-bar currenttime="{{currenttime}}" foreigntime="{{foreigntime}}" play="{{play}}" duration="{{duration}}" class="editing_toolbar"></editing-time-bar>
            </div>

        </div>

    </template>

    <script>
        Polymer({
            is: 'annotube-edit',

            properties: {
                videoId: {
                    type: String,
                    notify: true,
                    reflectToAttribute: true
                },
                currenttime:{
                  type: Number,
                  notify: true,
                },
                duration:{
                  type: Number,
                  notify: true
                }
            },
            ready: function () {
              var that = this;
              var url = "https://node.edouardg.fr/video/" + this.videoId;

              var http = new XMLHttpRequest();
              http.open("GET", url, true);
              http.setRequestHeader("Content-type", "application/json; charset=utf-8");
              http.withCredentials = true;
              http.send();

              http.onreadystatechange = function () {
                if (http.readyState == 4) {
                  if (http.status == 200) {

                    var res = JSON.parse(http.response);
                    console.log("coco video", res);
                    that.youtubeId = res.youtube;
                    that.videoName = res.name;
                    that.author = res.author;
                    that.annotations = res.annotations;
                    that.comments = res.comments;
                    that.thumbnail = res.thunbmail;
                    that.likes;
                    that.likeId;

                  } else if (http.status == 400) {
                    alert(JSON.parse(http.responseText).message);
                  } else if (http.status == 500) {
                    console.log("The server has encountered a situation it doesn 't know how to handle.");
                  } else if (http.status == 401) {
                    document.location = "/forbidden";
                  }
                }
              }
            },
        });
    </script>
</dom-module>